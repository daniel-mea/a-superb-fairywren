<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>A Superb Fairywren</title>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,wght@1,700&family=Fraunces:wght@500&display=swap" rel="stylesheet">
<style>
/* base reset */
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;
  font-family: 'Fraunces', serif;
  background-color: #000000;
}

.bg-layer {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: calc(var(--vh, 1vh) * 100);
  background-image: url('https://raw.githubusercontent.com/daniel-mea/a-superb-fairywren/main/docs/website_assets/newspaper_dark.jpg');
  background-size: cover;
  background-position: center center;
  background-repeat: no-repeat;
  z-index: 0;
  pointer-events: none;
}

body {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  align-items: center;
}

.header, .footer {
  position: relative;
  z-index: 10;
  color: #FFE555;
  width: 100%;
}

.header {
  padding-top: 15px;
  text-align: center;
  flex-shrink: 0;
}

.header img {
  width: 60px;
  border-radius: 50%;
  transition: width 0.3s ease;
  display: block;
  margin: 0 auto;
}

.header h1 {
  color: #FFE555;
  font-weight: 500;
  text-decoration: line-through;
  text-transform: uppercase;
  margin: 10px 0 0 0;
  font-size: 1.5em;
}

.book-section {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  pointer-events: none;
  z-index: 1;
  width: 100%;
  padding: 10px;
}

.book-container {
  pointer-events: auto;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
}

.book-image-wrapper {
  overflow: hidden;
}

.book-image {
  height: auto;
  display: block;
  transition: width 0.3s ease, transform 0.3s ease;
}

.book-image:hover {
  transform: scale(1.03);
}

.buy-button {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  padding: 10px;
  background-color: #FFE555;
  color: #000000;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  font-weight: 444;
  box-sizing: border-box;
  transition: width 0.3s ease, font-size 0.3s ease;
}

.buy-button a {
  color: #000000;
  text-decoration: none;
  transition: color 0.1s ease;
}

.buy-button a:hover {
  color: #ffffff;
}

.buy-button .separator {
  color: #000000;
  pointer-events: none;
}

.social {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin-top: 20px;
}

.social a img {
  width: 33px;
  vertical-align: middle;
}

.footer {
  padding-bottom: 15px;
  flex-shrink: 0;
}

@media (orientation: portrait) {
  .header img { width: 50px; }
  .social a img { width: 25px; }
}

@media (orientation: landscape) {
  .social a img { width: 22px; }
}

@media (max-width: 1000px) and (max-height: 500px) and (orientation: landscape) {
  .header {
    display: grid;
    place-items: center;
    padding-top: 15px;
  }
  .header a:first-child, .header a:nth-child(2) {
    grid-area: 1 / 1;
  }
  .header a:nth-child(2) {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .header h1 {
    margin: 0;
  }
  .header img {
    display: block;
    margin: 0 auto;
    width: 50px;
  }
}
</style>
</head>
<body>

<div class="bg-layer" aria-hidden="true"></div>

<div class="header">
  <a href="/home/"><img src="https://raw.githubusercontent.com/daniel-mea/a-superb-fairywren/main/docs/website_assets/site_logo-small.jpg" alt="Site Logo"></a>
  <a href="/home/" style="text-decoration:none;"><h1>A SUPERB FAIRYWREN</h1></a>
</div>

<div class="book-section">
  <div class="book-container">
    <div class="book-image-wrapper">
      <img src="https://raw.githubusercontent.com/daniel-mea/a-superb-fairywren/main/docs/website_assets/Mockup-1ASF_paperback.jpg" alt="A Superb Fairywren Book" class="book-image">
    </div>
    <div class="buy-button">
      <a href="https://buy.stripe.com/14AdRagju5GOfNh31LgrS00">Paperback</a>
      <span class="separator">·</span>
      <a href="https://buy.stripe.com/14AdRagju5GOfNh31LgrS00">eBook</a>
      <span class="separator">·</span>
      <a href="https://buy.stripe.com/14AdRagju5GOfNh31LgrS00">Audiobook</a>
    </div>
  </div>
</div>

<div class="footer">
  <div class="social">
    <a href="https://instagram.com/danny__mea" target="_blank"><img src="https://raw.githubusercontent.com/daniel-mea/a-superb-fairywren/711861aec693b89accf4e2ce56490d1f945656f4/docs/website_assets/icon_ig.svg" alt="Instagram"></a>
    <a href="/contact/"><img src="https://raw.githubusercontent.com/daniel-mea/a-superb-fairywren/2978373eaeac2a4b537306bf46ebce49d3b812c6/docs/website_assets/icon_email.svg" alt="Email"></a>
    <a href="https://www.youtube.com/@DannyMEA" target="_blank"><img src="https://raw.githubusercontent.com/daniel-mea/a-superb-fairywren/711861aec693b89accf4e2ce56490d1f945656f4/docs/website_assets/icon_yt.svg" alt="YouTube"></a>
  </div>
</div>

<script>
(function() {
  const setVh = () => {
    const vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', vh + 'px');
  };
  setVh();
  let tid = null;
  const debouncedSet = () => {
    clearTimeout(tid);
    tid = setTimeout(setVh, 80);
  };
  window.addEventListener('resize', debouncedSet);
  window.addEventListener('orientationchange', debouncedSet);
})();

const image = document.querySelector('.book-image');
const button = document.querySelector('.buy-button');
const header = document.querySelector('.header');
const footer = document.querySelector('.footer');

const full_img_w = 444;
const full_btn_w = 333;
const full_font = 17.5;
const min_w = 200;
const pad = 10;
const side_img_buffer = 40; // New: extra side buffer for image only
const gap = 15;

let ar = 0;

const resizeHandler = () => {
  if (ar === 0) return;

  const vw = window.innerWidth;
  const vh = window.innerHeight;

  // Reset to full sizes to measure accurately
  image.style.width = `${full_img_w}px`;
  button.style.width = `${full_btn_w}px`;
  button.style.fontSize = `${full_font}px`;

  const full_btn_h = button.offsetHeight;
  const btn_style = getComputedStyle(button);
  const btn_pad = parseFloat(btn_style.paddingTop) + parseFloat(btn_style.paddingBottom);
  const full_var_btn_h = full_btn_h - btn_pad;

  const avail_w = vw - 2 * pad;
  const avail_h = vh - header.offsetHeight - footer.offsetHeight - 2 * pad;

  // Phase 1: Image-specific available width includes extra side buffer
  const avail_w_img = avail_w - 2 * side_img_buffer;
  const max_img_w_from_w = avail_w_img;
  const max_img_h_from_h = avail_h - gap - full_btn_h;
  const max_img_w_from_h = max_img_h_from_h / ar;
  let candidate_img_w = Math.min(full_img_w, max_img_w_from_w, max_img_w_from_h);

  if (candidate_img_w >= full_btn_w) {
    // Phase 1: Set image width, button fixed
    image.style.width = `${candidate_img_w}px`;
    button.style.width = `${full_btn_w}px`;
    button.style.fontSize = `${full_font}px`;
  } else {
    // Phase 2: Shrink both proportionally (keeping widths equal), no extra buffer
    const a = full_btn_w * ar + full_var_btn_h;
    const b = gap + btn_pad;

    const s_fit_w = avail_w / full_btn_w;
    const s_fit_h = (avail_h - b) / a;
    let s_fit = Math.min(1, s_fit_w, s_fit_h);
    let s = Math.max(s_fit, min_w / full_btn_w);

    const final_w = full_btn_w * s;
    image.style.width = `${final_w}px`;
    button.style.width = `${final_w}px`;
    button.style.fontSize = `${full_font * s}px`;
  }
};

image.addEventListener('load', () => {
  ar = image.naturalHeight / image.naturalWidth;
  resizeHandler();
});

let resizeTid = null;
const debouncedResize = () => {
  clearTimeout(resizeTid);
  resizeTid = setTimeout(resizeHandler, 80);
};

window.addEventListener('resize', debouncedResize);
window.addEventListener('orientationchange', debouncedResize);
</script>

</body>
</html>